pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
#include piece.lua
#include challenge.lua
#include world.lua
#include setup.lua
#include ui.lua
#include menu.lua

function _init()
    DEBUG = false
    frame_timer = 0
    mode = "menu"
    world = nil
    change_mode("playing")
end

function _update60()
    if mode == "playing" then
        world:update_world()
        update_ui()
    elseif mode == "menu" then
        update_menu()
    end

    -- transition:update()
    frame_timer += 1
end

function _draw()
    cls(15)
    if mode == "playing" then
        world:draw_world()
        draw_ui()
    elseif mode == "menu" then
        draw_menu()
    end

    -- if transition.active then transition:draw() end
    print_debug()
end

function change_mode(new_mode)
    if new_mode == "playing" then
        world = World:new(CHALLENGES.clear_15_lines)
    end
    mode = new_mode
end

function debug(str)
    add(debug_list, str)
end

function print_debug()
    for d in all(debug_list) do
        print(d, 50, 50, 7)
    end
    debug_list = {}
end

__gfx__
0000000077777600eeeee800aaaaa90077777f0066666d0077777a00fffffe000000000000000000000000000000000000000000000000000000000000000000
0000000076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0000000076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0000000076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0000000076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
00000000655555008222220094444400feeeee00d1111100a9999900e22222000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666008888880099999900ffffff00dddddd00aaaaaa00eeeeee000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000666666008888880099999900ffffff00dddddd00aaaaaa00eeeeee000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077777600eeeee800aaaaa90077777f0066666d0077777a00fffffe000000000000000000000000000000000000000000000000000000000000000000
0000000077777500e7777200a777740077777e006777710077777900f77772000000000000000000000000000000000000000000000000000000000000000000
0000000077777500e7777200a777740077777e006777710077777900f77772000000000000000000000000000000000000000000000000000000000000000000
0000000077777500e7777200a777740077777e006777710077777900f77772000000000000000000000000000000000000000000000000000000000000000000
0000000077777500e7777200a777740077777e006777710077777900f77772000000000000000000000000000000000000000000000000000000000000000000
00000000655555008222220094444400feeeee00d1111100a9999900e22222000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000006600660066066606660000000006660000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000060006000606060606000060000006060000000
00000000000000000000000001111111111111111111111111111111111117777767777767777767777760000066606000606066006600000000006060000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000606000606060606000060000006060000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000066000660660060606660000000006660000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000000000000000000000000000000000000000
70000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000000000000000000000000000000000000000
07000000000000000000000001111111111111111111111111111111111116555556555556555556555550000000000000000000000000000000000000000000
007000000000000000000000011111111111111111111111111111111111111111111111111111111111100000000000077777f77777f0000000000000000000
07000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
70000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
0000000000000000000000000111111111111111111111111111111111111111111111111111111111111000000000000feeeeefeeeee0000000000000000000
000000000000000000000000011111111111111111111111111111111111111111111111111111111111100000077777f77777f0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
0000000000000000000000000111111111111111111111111111111111111111111111111111111111111000000feeeeefeeeee0000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
000000000000000000000000011111111111111111111111111111111111166666d66666d66666d66666d0000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
0000000000000000000000000111111111111111111111111111111111111d11111d11111d11111d111110000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__sfx__
001800001c5501c55017550185501a5501a5501855017550155501553015550185501c5501c5501a55018550175501753017550185501a5501a5501c5501c550185501855015550155301555015550005000e500
001800000477010770047701077004770107700477010770097701577009770157700977015770097701577008770147700877014770047701077004770107700977015770097701577009770157700b7700c770
001800001a5001a5501a5501d55021550215501f5501d5501c5501c5501c550185501c5501c5501a55018550175501753017550185501a5501a5501c5501c5501855018550155501553015550155500050000500
001800000e7700277000700027700d700027700977005770007700c770237000c770007700774007770247000b7701777021700177701c700107701c700147700977010770097701077009770097700070000700
00180000105501055010550105500c5500c5500c5500c5500e5500e5500e5500e5500b5500b5500b5500b5500c5500c5500c5500c55009550095500955009550085500855008550085500b5500b5500050000500
00180000157401c740157401c740157401c740157401c740147401c740147401c740147401c740147401c740157401c740157401c740157401c740157401c740147401c740147401c740147401c740147401c740
00180000105501055010550105500c5500c5500c5500c5500e5500e5500e5500e5500b5500b5500b5500b5500c5500c55010550105501555015550155501555014550145501455014550145000b5000050000500
00180000157401c740157401c740157401c740157401c740147401c740147401c740147401c740147401c740157401c740157401c740157401c740157401c740147401c740147401c740147001c700147001c700
000c00001c0501c0301c0301c050170501703017050170501c0501c0301c0301c050170501703017050170501c0301c0101c0101c030170301701017030170301c0301c0101c0101c03017030170101703017030
000c0000107701075010750107700b7700b7500b7700b770107701075010750107700b7700b7500b7700b770107701075010750107700b7700b7500b7700b770107701075010750107700b7700b7500b7700b770
000c00001c0501c050230502305028050280502705027050280502805023030230502405024050210502105023050230501f0501f05021050210501d0501d0501f0501f0501c0501c0501d0501d0501a0501a050
000c00001c0501c050170501705018050180501a0501a0501c0501c050170501705018050180501a0501a0501c0501c0502305023050280502805027050270502805028050230302305024050240502105021050
000c000023050230501f0501f05021050210501d0501d0501f0501f0501c0501c0501d0501d0501a0501a0501c0501c050170501705018050180501a0501a0501c0501c050170501705018050180501a0501a050
000c00001c0501c050000000000000000000000000000000000001a00000000000001d0501d0501b0501b0501c0501c0501f0001f00021000210001d0001d0001f0001f0001f0001f0001d0501d0501d0001d000
000c0000107701075010750107700c7700c7700977009770107701075010750107700f7700f7500b7700b770107701075010750107700c7700c75009770097701077010750107501077009770097500277002770
000c00001f0501f0501f0501f05021050210501d0501d0501f0501f0501f0501f05021050210501d0501d0501f0501f0502300023000240002400021000210002300023000230002300021050210502100021000
000c00000777007770137700777002770027700e7700e7700777007770137700777002770027700e7700e7700777007770137700777002770027700e7700e7700777007770137700777002770027700e7700e770
000c00002305023030230302305024050240502105021050230502303023030230502405024050210502105023050230500100001000000000000000000000000000000000000000000025050250502500025000
000c00000777007770137700777002770027700e7700e7700777007770137700777002770027700e7700e7700777007770137700777002770027700e7700e7700777007770137700777009770097701577015770
000c00002605026030260502603026050260302605026050280502805026050260302605026050250502505026050260302605026030260502603026050260502805028050260502603026050260502505025050
000c000002770027700e7700275002770027700e7700e770077700777013770077500777007770137701377002770027700e7700275002770027700e7700e7700777007770137700775007770077701377013770
000c00002605026030260502603026050260302605026050250502503025050250302505025030250502505024050240302405024030240502405021050210501d0501d0501f0501f05021050210501a0501a050
000c000002770027700e7700275002770027700e7700e77002770027700e7700275002770027700e7700e77002770027700e7700275002770027700e7700e77002770027700e7700275002770027700e7700e770
000c000021050210501f0301f0501a0501a0501f0501f05000000000001a0501c0501a0501a050170501705021050210501f0301f0501a0501a0501f0501f0501a000000001a0501c0501a0501a0501505015050
000c000002770027700e7700275002770027700e7700e77002770027700e7700275002770027700e7700e77003770037700f7700275002770027700e7700e77002770027700e7700275002770027700e7700e770
000c00001a0501a050000000000000000000000000000000000000000000000000001b0001b00000000010001d0001d0001c0001c000170001700017000170001c0001c0001c0001c0001b0501b0500000000000
0018000015550195501e55019550145501955015550195501255019550115501955015550195501e550195501455019550155501955012550195501155019550155501955015550125501a550175501455017550
0018000014550105501955015550125501955017550155501455012550115500e5501155012550195501755015550195501e55019550145501955015550195501255019550115501955015550195501e55019550
001800001455019550155501955012550195501155019550155501955015550125501a55017550145501755014550105501c55017550195501c55019550155501055014550155501555015550155001550015500
001800001c5501a5501955017550155501455015550175501955015550175501a550195501a5501c5501c550145501455015550175501955019550175501755019550195501e5501e5501b5501b5501e55020550
000c000021550215502155021550205502055020550205501e5501e5501c5501c5501b5501b55019550195501b5501b5501855018550195501955019550195500f0000f0000f0000f0000e0000e0000e0000d000
000c00001c5501c5501c5501c550000001f5001e5501f5501e5501e5501e5501e5501c5501c5501a5501a5501c5501c55019550195501a5501a55017550175501e5501e5501e5501e55000000215002055021550
000c0000205502055020550205501e5501e5501d5501d5501e5501e5501b5501b5501d5501d550195501955020550205501d5501d55019550195501d5501d5502055020550235502355026550265501d5501d550
000c000025550255501d5501d55023550235501d5501d5502155021550215502155023550235502155021550205502055021550215501e550205501e5501e5501e5501e5501e5501e5501e5001e5001e5001e500
__music__
01 00014b44
00 02034b44
04 00014b44
00 02034b44
00 04054b44
02 06074c44
01 08094344
00 0a094344
00 0b094344
00 0c094344
00 0d0e4344
00 0f104344
00 11124344
00 13144344
00 15164344
00 17184344
02 19164344
01 1a424344
00 1b424344
00 1c424344
00 1d424344
00 1e424344
00 1f424344
00 20424344
02 21424344

