pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
#include piece.lua
#include world.lua
#include ui.lua

function _init()
    DEBUG = false
    frame_timer = 0
    mode = "playing"
    world = World:new()
end

function _update()
    if mode == "playing" then
        world:update_world()
        update_ui()

        if world.state == WORLD_STATE.GAME_OVER and btnp(4) then
            world = World:new()
        end
    elseif mode == "menu" then
        update_menu()
    end

    -- transition:update()
    frame_timer += 1
end

function _draw()
    cls(0)
    if mode == "playing" then
        world:draw_world()
        draw_ui()
    elseif mode == "menu" then
        draw_menu()
    end

    -- if transition.active then transition:draw() end
    print_debug()

    -- draw borders
    line(0, 0, 0, 127, 7)
    line(0, 0, 127, 0, 7)
    line(0, 127, 127, 127, 7)
    line(127, 0, 127, 127, 7)
end

function debug(str)
    add(debug_list, str)
end

function print_debug()
    for d in all(debug_list) do
        print(d)
    end
    debug_list = {}
end

__gfx__
0000000077777600eeeee800aaaaa90077777f0066666d0077777a00fffffe001000000000000000000000000000000000000000000000000000000000000000
0000000076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0070070076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0007700076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
0007700076666500e8888200a99994007ffffe006dddd1007aaaa900feeee2000000000000000000000000000000000000000000000000000000000000000000
00700700655555008222220094444400feeeee00d1111100a9999900e22222000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666008888880099999900ffffff00dddddd00aaaaaa00eeeeee000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000600006008000080090000900f0000f00d0000d00a0000a00e0000e000000000000000000000000000000000000000000000000000000000000000000
00000000666666008888880099999900ffffff00dddddd00aaaaaa00eeeeee000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000006600660066066606660000000006660000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000060006000606060606000060000006060000000
00000000000000000000000001111111111111111111111111111111111117777767777767777767777760000066606000606066006600000000006060000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000606000606060606000060000006060000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000066000660660060606660000000006660000000
00000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000000000000000000000000000000000000000
70000000000000000000000001000011000011000011000011000011000017666657666657666657666650000000000000000000000000000000000000000000
07000000000000000000000001111111111111111111111111111111111116555556555556555556555550000000000000000000000000000000000000000000
007000000000000000000000011111111111111111111111111111111111111111111111111111111111100000000000077777f77777f0000000000000000000
07000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
70000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000007ffffe7ffffe0000000000000000000
0000000000000000000000000111111111111111111111111111111111111111111111111111111111111000000000000feeeeefeeeee0000000000000000000
000000000000000000000000011111111111111111111111111111111111111111111111111111111111100000077777f77777f0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000007ffffe7ffffe0000000000000000000000000
0000000000000000000000000111111111111111111111111111111111111111111111111111111111111000000feeeeefeeeee0000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000011000011000011000011000010000000000000000000000000000000000000000000
00000000000000000000000001111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000
000000000000000000000000011111111111111111111111111111111111166666d66666d66666d66666d0000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
00000000000000000000000001000011000011000011000011000011000016dddd16dddd16dddd16dddd10000000000000000000000000000000000000000000
0000000000000000000000000111111111111111111111111111111111111d11111d11111d11111d111110000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

